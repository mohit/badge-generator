<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Verify &amp; Create | Signet by Firmament Works</title>
  <meta name="description"
    content="Verify any Signet credential by URL or JSON, or create your own signed demo badge using prompt-to-badge.">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <meta property="og:title" content="Verify &amp; Create | Signet by Firmament Works">
  <meta property="og:description" content="Public Signet verifier with domain-bound trust state. Create a signed demo badge in seconds.">
  <meta property="og:image" content="https://badges.firmament.works/og-image.png">
  <meta property="og:url" content="https://badges.firmament.works/verify.html">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="preconnect" href="https://api.fontshare.com" crossorigin>
  <link href="https://api.fontshare.com/v2/css?f[]=boska@500,700&f[]=switzer@400,500,600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">
</head>

<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <header class="site-header">
    <nav class="site-nav container" aria-label="Primary">
      <a href="/" class="logo">
        <span class="logo-mark" aria-hidden="true"></span>
        <span class="logo-main">Signet</span>
        <span class="logo-byline">by Firmament Works</span>
      </a>
      <button class="mobile-menu-btn" type="button" aria-expanded="false" aria-controls="primary-nav">Menu</button>
      <ul class="nav-links" id="primary-nav">
        <li><a href="/">Home</a></li>
        <li><a href="/verify.html" class="active">Verify</a></li>
        <li><a href="/api.html">API</a></li>
        <li><a href="/issuer.html">Issuer Setup</a></li>
      </ul>
    </nav>
  </header>

  <main id="main-content">

    <!-- ── Hero ───────────────────────────────────────────────── -->
    <section class="verify-hero">
      <div class="container">
        <p class="kicker">Credential Tools</p>
        <h1 class="section-title" style="margin-bottom: 0.35rem;">Verify or create a credential</h1>
        <p class="section-lede">Verify any Signet credential by URL, JSON, or issuer domain. Or create your own signed demo badge using prompt-to-badge.</p>
      </div>
    </section>

    <!-- ── Tab bar ─────────────────────────────────────────────── -->
    <div class="page-tabs-bar">
      <div class="container">
        <nav class="page-tabs" aria-label="Tools">
          <button class="page-tab active" data-page-tab="verify">Verify a Credential</button>
          <button class="page-tab" data-page-tab="demo">Create a Signed Demo Badge</button>
          <a class="page-tab page-tab-ext" href="/issuer.html">Become a Verified Issuer ↗</a>
        </nav>
      </div>
    </div>

    <!-- ══════════════════════════════════════════════════════════
         TAB A: Verify a Credential
    ══════════════════════════════════════════════════════════ -->
    <div id="tab-section-verify" class="page-tab-section active">
      <section class="section" style="padding-top: 0.75rem;">
        <div class="container verify-layout">

          <!-- Left: verify form panel -->
          <section class="panel verify-panel">
            <div class="verify-tabs">
              <div class="verify-tab active" data-tab="url">By URL</div>
              <div class="verify-tab" data-tab="json">By JSON</div>
              <div class="verify-tab" data-tab="issuer">Issuer</div>
            </div>

            <div class="tab-content active" id="url-tab">
              <form id="url-form">
                <div class="form-group">
                  <label class="form-label" for="badge-url">Badge or credential URL</label>
                  <input type="url" id="badge-url" class="form-input"
                    placeholder="https://example.com/badges/assertion.json" required>
                  <small class="form-help">Fetches the resource and runs trust checks.</small>
                </div>
                <button type="submit" class="verify-button">
                  <span class="button-text">Verify URL</span>
                  <span class="loading-spinner" style="display: none;"></span>
                </button>
              </form>
            </div>

            <div class="tab-content" id="json-tab">
              <form id="json-form">
                <div class="form-group">
                  <label class="form-label" for="badge-json">Badge JSON payload</label>
                  <textarea id="badge-json" class="form-input form-textarea"
                    placeholder='{"@context":"https://www.w3.org/ns/credentials/v2","type":["VerifiableCredential","OpenBadgeCredential"],...}'
                    required></textarea>
                  <small class="form-help">Paste a full JSON object.</small>
                </div>
                <button type="submit" class="verify-button">
                  <span class="button-text">Verify JSON</span>
                  <span class="loading-spinner" style="display: none;"></span>
                </button>
              </form>
            </div>

            <div class="tab-content" id="issuer-tab">
              <form id="issuer-form">
                <div class="form-group">
                  <label class="form-label" for="issuer-url">Issuer URL</label>
                  <input type="url" id="issuer-url" class="form-input"
                    placeholder="https://example.com/.well-known/openbadges-issuer.json" required>
                  <small class="form-help">Checks issuer resource validity and key discoverability.</small>
                </div>
                <button type="submit" class="verify-button">
                  <span class="button-text">Verify issuer</span>
                  <span class="loading-spinner" style="display: none;"></span>
                </button>
              </form>
            </div>

            <div id="result-container" class="result-container" role="status" aria-live="polite">
              <div class="result-title">
                <span class="result-icon"></span>
                <span class="result-text"></span>
              </div>
              <div class="result-details"></div>
            </div>

            <div class="examples">
              <h3>Quick examples</h3>
              <div class="example-links">
                <a href="#" class="example-link" data-example="live">Live signed test</a>
                <a href="#" class="example-link" data-example="unsigned">Unsigned sample</a>
                <a href="#" class="example-link" data-example="issuer">Sample issuer</a>
                <a href="#" class="example-link" data-example="domain">openbadges.org</a>
              </div>
            </div>
          </section>

          <!-- Right: trust state legend -->
          <aside class="panel verify-panel scroll-animate">
            <div class="signal-stack">
              <div class="status-pill status-pass" style="justify-content: center; padding: 0.65rem; width: 100%;">
                Signature + domain key pass</div>
              <div class="status-pill status-warn" style="justify-content: center; padding: 0.65rem; width: 100%;">Valid
                signature, reserved demo domain</div>
              <div class="status-pill status-fail" style="justify-content: center; padding: 0.65rem; width: 100%;">Issuer
                not cryptographically verified</div>
            </div>
            <p class="signal-note" style="margin-top: 1rem; text-align: center;">
              This verifies domain/key control. It does not certify assessment quality or accreditation.
            </p>

            <div class="card" style="margin-top: 1.5rem; text-align: center;">
              <p class="eyebrow">Integrating?</p>
              <p class="small-note" style="margin-bottom: 0.8rem;">Build automated trust checks into your own application
                or agent.</p>
              <a href="/api.html" class="btn btn-secondary btn-block"
                style="padding: 0.5rem; font-size: var(--text-sm);">View API Documentation</a>
            </div>

            <div class="card" style="margin-top: 0.75rem; text-align: center;">
              <p class="eyebrow">Ready to issue?</p>
              <p class="small-note" style="margin-bottom: 0.8rem;">Set up your own domain-verified issuer and sign
                badges with your own keys.</p>
              <a href="/issuer.html" class="btn btn-secondary btn-block"
                style="padding: 0.5rem; font-size: var(--text-sm);">Issuer Setup Guide</a>
            </div>
          </aside>
        </div>
      </section>
    </div>

    <!-- ══════════════════════════════════════════════════════════
         TAB B: Create a Signed Demo Badge
    ══════════════════════════════════════════════════════════ -->
    <div id="tab-section-demo" class="page-tab-section">
      <section class="section" style="padding-top: 1rem; padding-bottom: 3rem;">
        <div class="container" style="max-width: 860px;">

          <div style="margin-bottom: 1.5rem;">
            <h2 class="section-title" style="font-size: var(--text-xl);">Create a signed demo badge</h2>
            <p class="section-lede">Fill in the details below and we'll generate a cryptographically signed
              Open Badge on the <code>example.com</code> demo domain. The result is a real verifiable credential —
              anyone can verify it via the public API. Use the MCP server or CLI to issue badges on your own verified domain.</p>
          </div>

          <article class="panel challenge-panel">
            <form id="prompt-badge-form" class="challenge-form">
              <div class="form-group">
                <label class="form-label" for="badge-name">Badge name</label>
                <input class="form-input" id="badge-name" name="badgeName" placeholder="Paper Comprehension Badge">
              </div>
              <div class="form-group">
                <label class="form-label" for="learner-name">Learner name</label>
                <input class="form-input" id="learner-name" name="learnerName" placeholder="Your name">
              </div>
              <div class="form-group">
                <label class="form-label" for="source-url">Source URL <span style="font-weight: 400; color: var(--steel);">(optional)</span></label>
                <input class="form-input" id="source-url" name="sourceUrl" placeholder="https://example.org/paper">
              </div>
              <div class="form-group">
                <label class="form-label" for="skills">Skills <span style="font-weight: 400; color: var(--steel);">(comma separated)</span></label>
                <input class="form-input" id="skills" name="skills" placeholder="critical reading, synthesis">
              </div>
              <div class="form-group">
                <label class="form-label" for="proficiency">Self-assessed proficiency</label>
                <select class="form-input" id="proficiency" name="proficiency">
                  <option value="">Select one</option>
                  <option value="beginner">Beginner</option>
                  <option value="intermediate">Intermediate</option>
                  <option value="advanced">Advanced</option>
                  <option value="expert">Expert</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label" for="summary">Assessment summary</label>
                <textarea class="form-input form-textarea" id="summary" name="summary" required
                  placeholder="Summarize what you learned and how you were assessed."></textarea>
              </div>
              <button class="verify-button" type="submit">Generate signed demo badge</button>
            </form>
            <div id="prompt-badge-result" class="challenge-result"></div>
          </article>

          <div class="card" style="margin-top: 1.2rem; background: var(--trust-light); border-color: rgba(29,78,216,0.2);">
            <p class="eyebrow" style="margin-bottom: 0.3rem;">Locked caveat</p>
            <p style="font-size: var(--text-sm); color: var(--ink-soft); line-height: 1.55;">
              Demo badges use the reserved <code>example.com</code> domain and are labeled <strong>DEMO</strong>.
              This verifies domain/key control — it does not certify assessment quality or accreditation.
              <a href="/issuer.html" style="color: var(--trust);">Set up your own issuer</a> to issue badges on a real verified domain.
            </p>
          </div>

        </div>
      </section>
    </div>

  </main>

  <footer>
    <div class="container footer-row">
      <p>Built by <a href="https://firmament.works" target="_blank" rel="noreferrer">Firmament Works</a>.</p>
      <div class="footer-links">
        <a href="/">Home</a>
        <a href="/api.html">API</a>
        <a href="/issuer.html">Issuer Setup</a>
        <a href="/llms.txt">llms.txt</a>
      </div>
    </div>
  </footer>

  <script>
    // ── Page-level tab switching ───────────────────────────────
    const pageTabs = document.querySelectorAll('.page-tab[data-page-tab]');
    const pageTabSections = document.querySelectorAll('.page-tab-section');

    function activatePageTab(name) {
      pageTabs.forEach((t) => t.classList.toggle('active', t.dataset.pageTab === name));
      pageTabSections.forEach((s) => s.classList.toggle('active', s.id === `tab-section-${name}`));
    }

    pageTabs.forEach((tab) => {
      tab.addEventListener('click', () => {
        activatePageTab(tab.dataset.pageTab);
        history.replaceState(null, '', `#${tab.dataset.pageTab}`);
      });
    });

    // Activate tab from URL hash on load
    const initialHash = window.location.hash.slice(1);
    if (initialHash === 'demo' || initialHash === 'verify') {
      activatePageTab(initialHash);
    }

    // ── Sub-tab switching (URL / JSON / Issuer) ───────────────
    const TRUST_STATES = {
      UNVERIFIED: 'UNVERIFIED',
      DOMAIN_VERIFIED_SIGNATURE: 'DOMAIN_VERIFIED_SIGNATURE',
      DEMO_DOMAIN_VERIFIED_SIGNATURE: 'DEMO_DOMAIN_VERIFIED_SIGNATURE'
    };

    document.querySelectorAll('.verify-tab').forEach((tab) => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.verify-tab').forEach((t) => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach((c) => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
        document.getElementById('result-container').style.display = 'none';
      });
    });

    const examples = {
      live: 'https://badges.firmament.works/samples/demo-openbadge-v3-signed.json',
      unsigned: 'https://badges.firmament.works/samples/demo-openbadge-v3.json',
      issuer: 'https://example.com/.well-known/openbadges-issuer.json',
      domain: 'https://openbadges.org'
    };

    const statusClassMap = {
      pass: 'status-pass',
      warn: 'status-warn',
      fail: 'status-fail',
      skip: 'status-skip'
    };

    const statusTextMap = {
      pass: 'pass',
      warn: 'warn',
      fail: 'fail',
      skip: 'skip'
    };

    function escapeHtml(input) {
      return String(input)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    function statusPill(state, text) {
      const css = statusClassMap[state] || 'status-skip';
      const label = escapeHtml(text || statusTextMap[state] || 'skip');
      return `<span class="status-pill ${css}">${label}</span>`;
    }

    function ladderRow(label, state, text) {
      return `<div class="result-ladder-row"><span class="label">${escapeHtml(label)}</span>${statusPill(state, text)}</div>`;
    }

    function trustBadge(trustState) {
      if (trustState === TRUST_STATES.DOMAIN_VERIFIED_SIGNATURE) {
        return '<span class="trust-badge trust-badge--verified">DOMAIN_VERIFIED_SIGNATURE</span>';
      }
      if (trustState === TRUST_STATES.DEMO_DOMAIN_VERIFIED_SIGNATURE) {
        return '<span class="trust-badge trust-badge--demo">DEMO_DOMAIN_VERIFIED_SIGNATURE</span>';
      }
      return '<span class="trust-badge trust-badge--unverified">UNVERIFIED</span>';
    }

    function isDemoDomain(domain) {
      if (!domain) return false;
      try {
        const parsed = new URL(String(domain).includes('://') ? domain : `https://${domain}`);
        const hostname = parsed.hostname.toLowerCase();
        return hostname === 'example.com' || hostname.endsWith('.example.com');
      } catch {
        return false;
      }
    }

    function resolveValidationLabel(result, issuerDomain) {
      const explicitLabel = result.validationLabel || result.verification?.validationLabel || null;
      if (explicitLabel) return explicitLabel;
      return isDemoDomain(issuerDomain) ? 'DEMO' : null;
    }

    function trustHeadline(trustState, issuerDomain, validationLabel) {
      if (trustState === TRUST_STATES.DOMAIN_VERIFIED_SIGNATURE) {
        const label = validationLabel ? ` ${statusPill('warn', validationLabel)}` : '';
        return `Signed by verified domain: <code>${escapeHtml(issuerDomain || 'unknown')}</code>${label}`;
      }
      if (trustState === TRUST_STATES.DEMO_DOMAIN_VERIFIED_SIGNATURE) {
        return `Demo badge from reserved domain: <code>${escapeHtml(issuerDomain || 'unknown')}</code> ${statusPill('warn', 'DEMO')}`;
      }
      return 'Issuer cannot be cryptographically verified.';
    }

    function sharedCaveat() {
      return 'This verifies domain/key control. It does not certify assessment quality or accreditation.';
    }

    document.querySelectorAll('.example-link').forEach((link) => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const type = link.dataset.example;
        if (type === 'live' || type === 'unsigned') {
          document.querySelector('[data-tab="url"]').click();
          document.getElementById('badge-url').value = examples[type];
          return;
        }
        if (type === 'domain') {
          document.querySelector('[data-tab="issuer"]').click();
          document.getElementById('issuer-url').value = examples.domain;
          return;
        }
        document.querySelector('[data-tab="issuer"]').click();
        document.getElementById('issuer-url').value = examples.issuer;
      });
    });

    document.getElementById('url-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      await verifyByUrl(document.getElementById('badge-url').value);
    });

    document.getElementById('json-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      await verifyByJson(document.getElementById('badge-json').value);
    });

    document.getElementById('issuer-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      await verifyIssuer(document.getElementById('issuer-url').value);
    });

    document.querySelectorAll('[data-demo-fill-link]').forEach((element) => {
      element.addEventListener('click', (e) => {
        e.preventDefault();
        document.querySelector('[data-tab="url"]').click();
        document.getElementById('badge-url').value = examples.live;
        verifyByUrl(examples.live);
      });
    });

    async function verifyByUrl(url) {
      const button = document.querySelector('#url-form .verify-button');
      const buttonText = button.querySelector('.button-text');
      const spinner = button.querySelector('.loading-spinner');

      try {
        showLoading(button, buttonText, spinner);
        const response = await fetch(`/public/api/verify/badge/${encodeURIComponent(url)}`);
        const result = await response.json();
        if (!response.ok) throw new Error(result.error || `HTTP ${response.status}`);
        showBadgeResult(result);
      } catch (error) {
        showError(`Verification failed: ${error.message}`);
      } finally {
        hideLoading(button, buttonText, spinner);
      }
    }

    async function verifyByJson(jsonStr) {
      const button = document.querySelector('#json-form .verify-button');
      const buttonText = button.querySelector('.button-text');
      const spinner = button.querySelector('.loading-spinner');

      try {
        showLoading(button, buttonText, spinner);
        const badgeData = JSON.parse(jsonStr);
        const response = await fetch('/public/api/verify/json', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ badgeData })
        });
        const result = await response.json();
        if (!response.ok) throw new Error(result.error || `HTTP ${response.status}`);
        showBadgeResult(result);
      } catch (error) {
        if (error instanceof SyntaxError) {
          showError('Invalid JSON format.');
        } else {
          showError(`Verification failed: ${error.message}`);
        }
      } finally {
        hideLoading(button, buttonText, spinner);
      }
    }

    async function verifyIssuer(url) {
      const button = document.querySelector('#issuer-form .verify-button');
      const buttonText = button.querySelector('.button-text');
      const spinner = button.querySelector('.loading-spinner');

      try {
        showLoading(button, buttonText, spinner);
        const response = await fetch(`/public/api/verify/issuer/${encodeURIComponent(url)}`);
        const result = await response.json();
        if (!response.ok) throw new Error(result.error || `HTTP ${response.status}`);
        showIssuerResult(result);
      } catch (error) {
        showError(`Issuer verification failed: ${error.message}`);
      } finally {
        hideLoading(button, buttonText, spinner);
      }
    }

    function showBadgeResult(result) {
      const container = document.getElementById('result-container');
      const icon = container.querySelector('.result-icon');
      const text = container.querySelector('.result-text');
      const details = container.querySelector('.result-details');

      const structureState = result.structure ? (result.structure.valid ? 'pass' : 'fail') : 'skip';
      const issuerState = result.issuer ? (result.issuer.valid ? 'pass' : 'fail') : 'skip';
      const signatureState = result.signature ? (result.signature.valid ? 'pass' : 'fail') : 'skip';
      const trustState = result.trustState || TRUST_STATES.UNVERIFIED;
      const issuerDomain = result.issuerDomain || result.issuer?.issuerDomain || 'unknown';
      const validationLabel = resolveValidationLabel(result, issuerDomain);
      const issuerClaimedName = result.issuerClaimedName || result.issuer?.issuerClaimedName || result.issuer?.issuer?.name || 'not provided';
      const keyFingerprint = result.keyFingerprint || result.signature?.keyFingerprint || 'not available';
      const reason = result.verificationReason || (trustState === TRUST_STATES.DOMAIN_VERIFIED_SIGNATURE
        ? 'Signature is valid and key is currently discoverable for this domain.'
        : trustState === TRUST_STATES.DEMO_DOMAIN_VERIFIED_SIGNATURE
          ? 'Signature is valid. Issuer uses the reserved example.com demo domain.'
          : 'Issuer cannot be cryptographically verified.');

      const isVerified = trustState === TRUST_STATES.DOMAIN_VERIFIED_SIGNATURE;
      const isDemo = trustState === TRUST_STATES.DEMO_DOMAIN_VERIFIED_SIGNATURE;
      const status = (isVerified || isDemo) ? 'success' : 'error';
      icon.textContent = (isVerified || isDemo) ? 'PASS' : 'FAIL';
      text.innerHTML = `${trustHeadline(trustState, issuerDomain, validationLabel)} ${trustBadge(trustState)}`;

      let detailsHtml = '';
      detailsHtml += `<p class="result-summary"><strong>Version:</strong> ${escapeHtml(result.version || 'unknown')} &nbsp; <strong>Level:</strong> ${escapeHtml(result.verificationLevel || 'unknown')}</p>`;
      detailsHtml += '<div class="issuer-block">';
      detailsHtml += `<div class="issuer-block__domain">Issued by ${escapeHtml(issuerDomain)}</div>`;
      if (validationLabel) {
        detailsHtml += `<div class="issuer-block__meta">Validation label: ${statusPill('warn', validationLabel)}</div>`;
      }
      detailsHtml += `<div class="issuer-block__meta">Claimed name: ${escapeHtml(issuerClaimedName)}</div>`;
      detailsHtml += `<div class="issuer-block__fingerprint">Key fingerprint: ${escapeHtml(keyFingerprint)}</div>`;
      detailsHtml += '</div>';
      detailsHtml += `<p class="small-note" style="margin-top:0.55rem;">${escapeHtml(reason)}</p>`;
      detailsHtml += '<div class="result-ladder">';
      detailsHtml += ladderRow('Structure', structureState, statusTextMap[structureState]);
      detailsHtml += ladderRow('Issuer', issuerState, statusTextMap[issuerState]);
      detailsHtml += ladderRow('Signature', signatureState, signatureState === 'skip' ? 'not present' : statusTextMap[signatureState]);
      detailsHtml += '</div>';

      if (result.structure?.errors?.length) {
        detailsHtml += '<div class="result-list"><p>Errors</p><ul>';
        result.structure.errors.forEach((entry) => {
          detailsHtml += `<li>${escapeHtml(entry)}</li>`;
        });
        detailsHtml += '</ul></div>';
      }

      if (result.structure?.warnings?.length) {
        detailsHtml += '<div class="result-list"><p>Warnings</p><ul>';
        result.structure.warnings.forEach((entry) => {
          detailsHtml += `<li>${escapeHtml(entry)}</li>`;
        });
        detailsHtml += '</ul></div>';
      }

      detailsHtml += `<div class="caveat-banner">${escapeHtml(sharedCaveat())}</div>`;

      details.innerHTML = detailsHtml;
      container.className = `result-container result-${status}`;
      container.style.display = 'block';
      container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    function showIssuerResult(result) {
      const container = document.getElementById('result-container');
      const icon = container.querySelector('.result-icon');
      const text = container.querySelector('.result-text');
      const details = container.querySelector('.result-details');

      const trustState = result.trustState || (result.verification?.valid ? TRUST_STATES.DOMAIN_VERIFIED_SIGNATURE : TRUST_STATES.UNVERIFIED);
      const issuerDomain = result.issuerDomain || result.verification?.issuerDomain || 'unknown';
      const validationLabel = resolveValidationLabel(result, issuerDomain);
      const claimedName = result.issuerClaimedName || result.verification?.issuerClaimedName || result.verification?.issuer?.name || 'not provided';
      const keyFingerprint = result.keyFingerprint || result.verification?.keyFingerprint || 'not available';
      const reason = result.verificationReason || (trustState === TRUST_STATES.DOMAIN_VERIFIED_SIGNATURE
        ? 'Signature is valid and key is currently discoverable for this domain.'
        : trustState === TRUST_STATES.DEMO_DOMAIN_VERIFIED_SIGNATURE
          ? 'Signature is valid. Issuer uses the reserved example.com demo domain.'
          : 'Issuer cannot be cryptographically verified.');
      const isVerified = trustState === TRUST_STATES.DOMAIN_VERIFIED_SIGNATURE;
      const isDemo = trustState === TRUST_STATES.DEMO_DOMAIN_VERIFIED_SIGNATURE;
      const status = (isVerified || isDemo) ? 'success' : 'error';

      icon.textContent = (isVerified || isDemo) ? 'PASS' : 'FAIL';
      text.innerHTML = `${trustHeadline(trustState, issuerDomain, validationLabel)} ${trustBadge(trustState)}`;

      let detailsHtml = `<p class="result-summary"><strong>Type:</strong> ${escapeHtml(result.verification?.type || 'unknown')}</p>`;
      detailsHtml += '<div class="issuer-block">';
      detailsHtml += `<div class="issuer-block__domain">Issued by ${escapeHtml(issuerDomain)}</div>`;
      if (validationLabel) {
        detailsHtml += `<div class="issuer-block__meta">Validation label: ${statusPill('warn', validationLabel)}</div>`;
      }
      detailsHtml += `<div class="issuer-block__meta">Claimed name: ${escapeHtml(claimedName)}</div>`;
      detailsHtml += `<div class="issuer-block__fingerprint">Key fingerprint: ${escapeHtml(keyFingerprint)}</div>`;
      detailsHtml += '</div>';
      detailsHtml += `<div class="result-list"><p>Message</p><ul><li>${escapeHtml(result.verification?.message || reason)}</li></ul></div>`;
      detailsHtml += `<div class="caveat-banner">${escapeHtml(sharedCaveat())}</div>`;

      details.innerHTML = detailsHtml;
      container.className = `result-container result-${status}`;
      container.style.display = 'block';
      container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    function showError(message) {
      const container = document.getElementById('result-container');
      container.querySelector('.result-icon').textContent = 'FAIL';
      container.querySelector('.result-text').innerHTML = `Issuer cannot be cryptographically verified. ${trustBadge(TRUST_STATES.UNVERIFIED)}`;
      container.querySelector('.result-details').innerHTML = `
        <p class="result-summary">${escapeHtml(message)}</p>
        <div class="caveat-banner">${escapeHtml(sharedCaveat())}</div>
      `;
      container.className = 'result-container result-error';
      container.style.display = 'block';
      container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    function showLoading(button, buttonText, spinner) {
      button.disabled = true;
      buttonText.style.display = 'none';
      spinner.style.display = 'inline-block';
    }

    function hideLoading(button, buttonText, spinner) {
      button.disabled = false;
      buttonText.style.display = 'inline';
      spinner.style.display = 'none';
    }

    // Handle ?url=&autoverify=1 query params (for incoming links)
    const params = new URLSearchParams(window.location.search);
    const queryUrl = params.get('url');
    const autoVerify = params.get('autoverify') === '1';
    if (queryUrl) {
      document.getElementById('badge-url').value = queryUrl;
      document.querySelector('[data-tab="url"]').click();
      if (autoVerify) {
        verifyByUrl(queryUrl);
      }
    }
  </script>
  <script src="/scripts.js"></script>
</body>

</html>
